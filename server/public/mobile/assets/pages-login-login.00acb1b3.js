import{r as e,a as t,o as l,b as a,w as o,e as s,n,l as r,t as u,f as i,E as c,g as d,F as p,p as f,d as m,z as g,aj as y,af as h,u as _,a0 as b,G as x,c as v,A as C,ah as k,a8 as w,ak as V,al as S,I as $,am as j,x as B,j as T,k as L,v as z,an as I,ao as U,M as O,ap as N,aq as A,i as F,P as G,ar as R}from"./index.79c3669d.js";import{_ as E}from"./page-meta.d41892be.js";import{_ as W}from"./u-image.33995e93.js";import{_ as Z}from"./u-button.b9700564.js";import{_ as q}from"./u-input.b68e9272.js";import{_ as D}from"./u-verification-code.47979d6d.js";import{_ as M}from"./u-checkbox.6a3eb06b.js";import{_ as P}from"./u-loading.455c5c91.js";import{_ as H}from"./u-popup.2ebfc632.js";import{_ as J}from"./plugin-vue_export-helper.21dcd24c.js";import{u as K}from"./useLockFn.19eaaceb.js";import"./u-icon.fc3bf852.js";import"./emitter.5b880544.js";var Q=J({name:"u-modal",emits:["update:modelValue","input","confirm","cancel"],props:{value:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!1},zIndex:{type:[Number,String],default:""},title:{type:[String],default:"提示"},width:{type:[Number,String],default:600},content:{type:String,default:"内容"},showTitle:{type:Boolean,default:!0},showConfirmButton:{type:Boolean,default:!0},showCancelButton:{type:Boolean,default:!1},confirmText:{type:String,default:"确认"},cancelText:{type:String,default:"取消"},confirmColor:{type:String,default:"#2979ff"},cancelColor:{type:String,default:"#606266"},borderRadius:{type:[Number,String],default:16},titleStyle:{type:Object,default:()=>({})},contentStyle:{type:Object,default:()=>({})},cancelStyle:{type:Object,default:()=>({})},confirmStyle:{type:Object,default:()=>({})},zoom:{type:Boolean,default:!0},asyncClose:{type:Boolean,default:!1},maskCloseAble:{type:Boolean,default:!1},negativeTop:{type:[String,Number],default:0},blur:{type:[Number,String],default:0}},data:()=>({loading:!1,popupValue:!1}),computed:{valueCom(){return this.modelValue},cancelBtnStyle(){return Object.assign({color:this.cancelColor},this.cancelStyle)},confirmBtnStyle(){return Object.assign({color:this.confirmColor},this.confirmStyle)},uZIndex(){return this.zIndex?this.zIndex:this.$u.zIndex.popup}},watch:{valueCom(e){!0===e&&(this.loading=!1),this.popupValue=e}},methods:{confirm(){this.asyncClose?this.loading=!0:(this.$emit("input",!1),this.$emit("update:modelValue",!1)),this.$emit("confirm")},cancel(){this.$emit("cancel"),this.$emit("input",!1),this.$emit("update:modelValue",!1),setTimeout((()=>{this.loading=!1}),300)},popupClose(){this.$emit("input",!1),this.$emit("update:modelValue",!1)},clearLoading(){this.loading=!1}}},[["render",function(m,g,y,h,_,b){const x=f,v=e(t("u-loading"),P),C=e(t("u-popup"),H);return l(),a(x,null,{default:o((()=>[s(C,{blur:y.blur,zoom:y.zoom,mode:"center",popup:!1,"z-index":b.uZIndex,modelValue:_.popupValue,"onUpdate:modelValue":g[0]||(g[0]=e=>_.popupValue=e),length:y.width,"mask-close-able":y.maskCloseAble,"border-radius":y.borderRadius,onClose:b.popupClose,"negative-top":y.negativeTop},{default:o((()=>[s(x,{class:"u-model"},{default:o((()=>[y.showTitle?(l(),a(x,{key:0,class:"u-model__title u-line-1",style:n([y.titleStyle])},{default:o((()=>[r(u(y.title),1)])),_:1},8,["style"])):i("v-if",!0),s(x,{class:"u-model__content"},{default:o((()=>[m.$slots.default||m.$slots.$default?(l(),a(x,{key:0,style:n([y.contentStyle])},{default:o((()=>[c(m.$slots,"default",{},void 0,!0)])),_:3},8,["style"])):(l(),a(x,{key:1,class:"u-model__content__message",style:n([y.contentStyle])},{default:o((()=>[r(u(y.content),1)])),_:1},8,["style"]))])),_:3}),y.showCancelButton||y.showConfirmButton?(l(),a(x,{key:1,class:"u-model__footer u-border-top"},{default:o((()=>[y.showCancelButton?(l(),a(x,{key:0,"hover-stay-time":100,"hover-class":"u-model__btn--hover",class:"u-model__footer__button",style:n([b.cancelBtnStyle]),onClick:b.cancel},{default:o((()=>[r(u(y.cancelText),1)])),_:1},8,["style","onClick"])):i("v-if",!0),y.showConfirmButton||m.$slots["confirm-button"]?(l(),a(x,{key:1,"hover-stay-time":100,"hover-class":y.asyncClose?"none":"u-model__btn--hover",class:"u-model__footer__button hairline-left",style:n([b.confirmBtnStyle]),onClick:b.confirm},{default:o((()=>[m.$slots["confirm-button"]?c(m.$slots,"confirm-button",{key:0},void 0,!0):(l(),d(p,{key:1},[_.loading?(l(),a(v,{key:0,mode:"circle",color:y.confirmColor},null,8,["color"])):(l(),d(p,{key:1},[r(u(y.confirmText),1)],64))],64))])),_:3},8,["hover-class","style","onClick"])):i("v-if",!0)])),_:3})):i("v-if",!0)])),_:3})])),_:3},8,["blur","zoom","z-index","modelValue","length","mask-close-able","border-radius","onClose","negative-top"])])),_:3})}],["__scopeId","data-v-35116f03"]]);var X=J(m({__name:"login",setup(n){const c=g(!0);c.value=y();const m=z(),P=h(),H=_(),J=g(!1),X=b(),Y=g("");g(!1);const ee=g(!1),te=x({scene:1,account:"",password:"",code:""}),le=g(!1);g();const ae=e=>{Y.value=e};v((()=>H.getWebsiteConfig));const oe=async()=>{var e,t;te.account&&(null==(e=X.value)?void 0:e.canGetCode)&&(await I({scene:U.LOGIN,mobile:te.account}),uni.$u.toast("发送成功"),null==(t=X.value)||t.start())},se=e=>{te.scene=e},ne=e=>{var t;return null==(t=H.getLoginConfig.login_way)?void 0:t.includes(String(e))},re=v((()=>H.getLoginConfig.wechat_auth)),ue=v((()=>1==H.getLoginConfig.login_agreement)),ie=v((()=>1==H.getLoginConfig.third_auth)),ce=v((()=>1==H.getLoginConfig.coerce_mobile)),de=async e=>{const{token:t,mobile:l}=e;if(!l&&ce.value)return P.temToken=t,m.navigateTo("/pages/bind_mobile/bind_mobile"),void V();P.login(e.token),await P.getUser(),uni.$u.toast("登录成功"),V();if(O().length>1)await m.navigateBack();else if(N.get(A))try{m.redirectTo(N.get(A))}finally{m.switchTab(N.get(A))}else m.reLaunch("/pages/index/index");N.remove(A)},{lockFn:pe}=K((async()=>{if(!ee.value&&ue.value)return J.value=!0;if(1==te.scene){if(!te.account)return uni.$u.toast("请输入账号/手机号码");if(!te.password)return uni.$u.toast("请输入密码")}if(2==te.scene){if(!te.account)return uni.$u.toast("请输入手机号码");if(!te.code)return uni.$u.toast("请输入验证码")}w({title:"请稍后..."});try{const e=await R(te);de(e)}catch(e){V(),uni.$u.toast(e)}})),fe=async()=>{if(!ee.value&&ue.value)return J.value=!0,void console.log(J.value);c.value&&j.getUrl()};C((()=>H.getLoginConfig),(e=>{e.login_way&&(te.scene=e.login_way[0])}),{immediate:!0});const me=v((()=>!(1!=te.scene||!te.account||!te.password)||!(2!=te.scene||!te.account||!te.code)));return k((async()=>{try{P.isLogin&&(w({title:"请稍后..."}),await P.getUser(),V(),S())}catch(e){V()}})),$((async e=>{if(P.isLogin)return void m.reLaunch("/pages/index/index");const{code:t}=e;if(t){w({title:"请稍后..."});try{const e=await j.setAuthData(t);de(e)}catch(l){throw V(),m.redirectTo("/pages/login/login"),new Error(l)}}})),(n,m)=>{const g=e(t("page-meta"),E),y=e(t("u-image"),W),h=f,_=e(t("u-button"),Z),b=e(t("u-input"),q),x=F,v=e(t("u-verification-code"),D),C=G,k=e(t("u-checkbox"),M),w=e(t("u-modal"),Q);return l(),d(p,null,[s(g,{"page-style":n.$theme.pageStyle},null,8,["page-style"]),s(h,{class:"bg-white login min-h-full flex flex-col items-center px-[40rpx] pt-[120rpx] box-border"},{default:o((()=>[s(h,null,{default:o((()=>[s(y,{src:B(H).getWebsiteConfig.shop_logo,mode:"widthFix",height:"160",width:"160"},null,8,["src"])])),_:1}),s(h,{class:"w-full mt-[140rpx] pb-[60rpx]"},{default:o((()=>[le.value?i("v-if",!0):(l(),d(p,{key:0},[B(ie)&&c.value&&B(re)?(l(),a(h,{key:0},{default:o((()=>[s(_,{type:"primary",onClick:fe,customStyle:{height:"100rpx"},"hover-class":"none"},{default:o((()=>[r(" 用户一键登录 ")])),_:1})])),_:1})):i("v-if",!0),s(h,{class:"mt-[40rpx]"},{default:o((()=>[s(_,{onClick:m[0]||(m[0]=e=>le.value=!le.value),customStyle:{height:"100rpx"},"hover-class":"none"},{default:o((()=>[r(" 手机号登录 ")])),_:1})])),_:1})],64)),le.value?(l(),d(p,{key:1},[i(" 密码登录 "),1==te.scene&&ne(1)?(l(),d(p,{key:0},[s(h,{class:"px-[18rpx] border border-solid border-lightc border-light rounded-[10rpx] h-[100rpx] items-center flex"},{default:o((()=>[s(b,{class:"flex-1",modelValue:te.account,"onUpdate:modelValue":m[1]||(m[1]=e=>te.account=e),border:!1,placeholder:"输入账号"},null,8,["modelValue"])])),_:1}),s(h,{class:"px-[18rpx] py-[10rpx] border border-solid border-light rounded-[10rpx] flex h-[100rpx] items-center mt-[40rpx]"},{default:o((()=>[s(b,{class:"flex-1",modelValue:te.password,"onUpdate:modelValue":m[2]||(m[2]=e=>te.password=e),type:"password",placeholder:"输入密码",border:!1},null,8,["modelValue"]),s(x,{url:"/pages/forget_pwd/forget_pwd","hover-class":"none"},{default:o((()=>[s(h,{class:"border-l border-solid border-0 border-light pl-3 text-muted leading-4 ml-3"},{default:o((()=>[r(" 忘记密码？ ")])),_:1})])),_:1})])),_:1})],64)):i("v-if",!0),i(" 验证码登录 "),2==te.scene&&ne(2)?(l(),d(p,{key:1},[s(h,{class:"px-[18rpx] border border-solid border-lightc border-light rounded-[10rpx] h-[100rpx] items-center flex"},{default:o((()=>[s(b,{class:"flex-1",modelValue:te.account,"onUpdate:modelValue":m[3]||(m[3]=e=>te.account=e),border:!1,placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1}),s(h,{class:"px-[18rpx] border border-solid border-lightc border-light rounded-[10rpx] h-[100rpx] items-center flex mt-[40rpx]"},{default:o((()=>[s(b,{class:"flex-1",modelValue:te.code,"onUpdate:modelValue":m[4]||(m[4]=e=>te.code=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),s(h,{class:"border-l border-solid border-0 border-light pl-3 leading-4 ml-3 w-[180rpx]",onClick:oe},{default:o((()=>[s(v,{ref_key:"uCodeRef",ref:X,seconds:60,onChange:ae,"change-text":"x秒"},null,512),s(C,{class:T(te.account?"text-primary":"text-muted")},{default:o((()=>[r(u(Y.value),1)])),_:1},8,["class"])])),_:1})])),_:1})],64)):i("v-if",!0)],64)):i("v-if",!0),B(ue)?(l(),a(h,{key:2,class:"mt-[40rpx]"},{default:o((()=>[s(k,{modelValue:ee.value,"onUpdate:modelValue":m[7]||(m[7]=e=>ee.value=e),shape:"circle"},{default:o((()=>[s(h,{class:"text-xs flex"},{default:o((()=>[r(" 已阅读并同意 "),s(h,{onClick:m[5]||(m[5]=L((()=>{}),["stop"]))},{default:o((()=>[s(x,{class:"text-primary","hover-class":"none",url:"/pages/agreement/agreement?type=service"},{default:o((()=>[r(" 《服务协议》 ")])),_:1})])),_:1}),r(" 和 "),s(h,{onClick:m[6]||(m[6]=L((()=>{}),["stop"]))},{default:o((()=>[s(x,{class:"text-primary","hover-class":"none",url:"/pages/agreement/agreement?type=privacy"},{default:o((()=>[r(" 《隐私协议》 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):i("v-if",!0),le.value?(l(),d(p,{key:3},[s(h,{class:"mt-[60rpx]"},{default:o((()=>[s(_,{type:"primary",onClick:m[8]||(m[8]=e=>B(pe)(te.scene)),customStyle:{height:"100rpx",opacity:B(me)?"1":"0.5"},"hover-class":"none"},{default:o((()=>[r(" 登录 ")])),_:1},8,["customStyle"])])),_:1}),s(h,{class:"flex justify-between mt-[40rpx]"},{default:o((()=>[s(h,null,{default:o((()=>[r("已有账号，使用 "),2==te.scene&&ne(1)?(l(),d("span",{key:0,class:"text-primary",onClick:m[9]||(m[9]=e=>se(1))},"密码登录")):i("v-if",!0),1==te.scene&&ne(2)?(l(),d("span",{key:1,class:"text-primary",onClick:m[10]||(m[10]=e=>se(2))},"验证码登录")):i("v-if",!0)])),_:1}),s(x,{url:"/pages/register/register","hover-class":"none"},{default:o((()=>[r("注册账号")])),_:1})])),_:1})],64)):i("v-if",!0)])),_:1}),i(" 协议弹框 "),s(w,{modelValue:J.value,"onUpdate:modelValue":m[11]||(m[11]=e=>J.value=e),"show-cancel-button":"","show-title":!1,onConfirm:m[12]||(m[12]=e=>{ee.value=!0,J.value=!1}),onCancel:m[13]||(m[13]=e=>J.value=!1)},{default:o((()=>[s(h,{class:"text-center px-[70rpx] py-[60rpx]"},{default:o((()=>[s(h,null,{default:o((()=>[r(" 请先阅读并同意 ")])),_:1}),s(h,{class:"flex justify-center"},{default:o((()=>[s(x,{"data-theme":"",url:"/pages/agreement/agreement?type=service"},{default:o((()=>[s(h,{class:"text-primary"},{default:o((()=>[r("《服务协议》")])),_:1})])),_:1}),r(" 和 "),s(x,{url:"/pages/agreement/agreement?type=privacy"},{default:o((()=>[s(h,{class:"text-primary"},{default:o((()=>[r("《隐私协议》")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})],64)}}}),[["__scopeId","data-v-6b081f87"]]);export{X as default};
