import{r as e,a as t,o as a,b as l,w as o,e as s,n,l as r,t as u,f as i,E as c,g as d,F as p,p as f,d as m,z as g,aj as y,af as h,u as _,a0 as b,G as v,c as x,A as C,I as k,ak as w,al as V,a8 as S,am as j,x as $,j as B,k as T,an as L,v as I,ao as z,ap as U,M as O,aq as N,ar as A,as as G,i as F,P as q,at as R}from"./index.04b6eec4.js";import{_ as D}from"./page-meta.c55b99ba.js";import{_ as P}from"./u-image.92ccec93.js";import{_ as W}from"./u-button.aba32e24.js";import{_ as Z}from"./u-input.97e82bdc.js";import{_ as E}from"./u-verification-code.08ac7c35.js";import{_ as M}from"./u-checkbox.83d689a2.js";import{_ as H}from"./u-loading.6efba1c5.js";import{_ as J}from"./u-popup.2fa979e9.js";import{_ as K}from"./plugin-vue_export-helper.21dcd24c.js";import{u as Q}from"./useLockFn.4ff10cc7.js";import"./u-icon.91768b19.js";import"./emitter.5b880544.js";var X=K({name:"u-modal",emits:["update:modelValue","input","confirm","cancel"],props:{value:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!1},zIndex:{type:[Number,String],default:""},title:{type:[String],default:"提示"},width:{type:[Number,String],default:600},content:{type:String,default:"内容"},showTitle:{type:Boolean,default:!0},showConfirmButton:{type:Boolean,default:!0},showCancelButton:{type:Boolean,default:!1},confirmText:{type:String,default:"确认"},cancelText:{type:String,default:"取消"},confirmColor:{type:String,default:"#2979ff"},cancelColor:{type:String,default:"#606266"},borderRadius:{type:[Number,String],default:16},titleStyle:{type:Object,default:()=>({})},contentStyle:{type:Object,default:()=>({})},cancelStyle:{type:Object,default:()=>({})},confirmStyle:{type:Object,default:()=>({})},zoom:{type:Boolean,default:!0},asyncClose:{type:Boolean,default:!1},maskCloseAble:{type:Boolean,default:!1},negativeTop:{type:[String,Number],default:0},blur:{type:[Number,String],default:0}},data:()=>({loading:!1,popupValue:!1}),computed:{valueCom(){return this.modelValue},cancelBtnStyle(){return Object.assign({color:this.cancelColor},this.cancelStyle)},confirmBtnStyle(){return Object.assign({color:this.confirmColor},this.confirmStyle)},uZIndex(){return this.zIndex?this.zIndex:this.$u.zIndex.popup}},watch:{valueCom(e){!0===e&&(this.loading=!1),this.popupValue=e}},methods:{confirm(){this.asyncClose?this.loading=!0:(this.$emit("input",!1),this.$emit("update:modelValue",!1)),this.$emit("confirm")},cancel(){this.$emit("cancel"),this.$emit("input",!1),this.$emit("update:modelValue",!1),setTimeout((()=>{this.loading=!1}),300)},popupClose(){this.$emit("input",!1),this.$emit("update:modelValue",!1)},clearLoading(){this.loading=!1}}},[["render",function(m,g,y,h,_,b){const v=f,x=e(t("u-loading"),H),C=e(t("u-popup"),J);return a(),l(v,null,{default:o((()=>[s(C,{blur:y.blur,zoom:y.zoom,mode:"center",popup:!1,"z-index":b.uZIndex,modelValue:_.popupValue,"onUpdate:modelValue":g[0]||(g[0]=e=>_.popupValue=e),length:y.width,"mask-close-able":y.maskCloseAble,"border-radius":y.borderRadius,onClose:b.popupClose,"negative-top":y.negativeTop},{default:o((()=>[s(v,{class:"u-model"},{default:o((()=>[y.showTitle?(a(),l(v,{key:0,class:"u-model__title u-line-1",style:n([y.titleStyle])},{default:o((()=>[r(u(y.title),1)])),_:1},8,["style"])):i("v-if",!0),s(v,{class:"u-model__content"},{default:o((()=>[m.$slots.default||m.$slots.$default?(a(),l(v,{key:0,style:n([y.contentStyle])},{default:o((()=>[c(m.$slots,"default",{},void 0,!0)])),_:3},8,["style"])):(a(),l(v,{key:1,class:"u-model__content__message",style:n([y.contentStyle])},{default:o((()=>[r(u(y.content),1)])),_:1},8,["style"]))])),_:3}),y.showCancelButton||y.showConfirmButton?(a(),l(v,{key:1,class:"u-model__footer u-border-top"},{default:o((()=>[y.showCancelButton?(a(),l(v,{key:0,"hover-stay-time":100,"hover-class":"u-model__btn--hover",class:"u-model__footer__button",style:n([b.cancelBtnStyle]),onClick:b.cancel},{default:o((()=>[r(u(y.cancelText),1)])),_:1},8,["style","onClick"])):i("v-if",!0),y.showConfirmButton||m.$slots["confirm-button"]?(a(),l(v,{key:1,"hover-stay-time":100,"hover-class":y.asyncClose?"none":"u-model__btn--hover",class:"u-model__footer__button hairline-left",style:n([b.confirmBtnStyle]),onClick:b.confirm},{default:o((()=>[m.$slots["confirm-button"]?c(m.$slots,"confirm-button",{key:0},void 0,!0):(a(),d(p,{key:1},[_.loading?(a(),l(x,{key:0,mode:"circle",color:y.confirmColor},null,8,["color"])):(a(),d(p,{key:1},[r(u(y.confirmText),1)],64))],64))])),_:3},8,["hover-class","style","onClick"])):i("v-if",!0)])),_:3})):i("v-if",!0)])),_:3})])),_:3},8,["blur","zoom","z-index","modelValue","length","mask-close-able","border-radius","onClose","negative-top"])])),_:3})}],["__scopeId","data-v-35116f03"]]);var Y=K(m({__name:"login",setup(n){const c=g(!0);c.value=y();const m=L(),H=I(),J=h(),K=_(),Y=g(!1),ee=b(),te=g("");g(!1);const ae=g(!1),le=v({scene:1,account:"",password:"",code:""}),oe=g(!1),se=g(),ne=e=>{te.value=e};x((()=>K.getWebsiteConfig));const re=async()=>{var e,t;le.account&&(null==(e=ee.value)?void 0:e.canGetCode)&&(await z({scene:U.LOGIN,mobile:le.account}),uni.$u.toast("发送成功"),null==(t=ee.value)||t.start())},ue=e=>{le.scene=e},ie=e=>{var t;return null==(t=K.getLoginConfig.login_way)?void 0:t.includes(String(e))},ce=x((()=>K.getLoginConfig.wechat_auth)),de=x((()=>1==K.getLoginConfig.login_agreement)),pe=x((()=>1==K.getLoginConfig.third_auth)),fe=x((()=>1==K.getLoginConfig.coerce_mobile)),me=async e=>{const{token:t,mobile:a}=e;if(!a&&fe.value)return J.temToken=t,H.navigateTo("/pages/bind_mobile/bind_mobile"),void j();J.login(e.token),await J.getUser(),uni.$u.toast("登录成功"),j();const l=O();if(l.length>1){const e=l[l.length-2];await H.navigateBack();const{onLoad:t,options:a}=e;t&&t(a)}else if(N.get(A))try{H.redirectTo(N.get(A))}finally{H.switchTab(N.get(A))}else H.reLaunch("/pages/index/index");N.remove(A)},{lockFn:ge}=Q((async()=>{if(!ae.value&&de.value)return Y.value=!0;if(1==le.scene){if(!le.account)return uni.$u.toast("请输入账号/手机号码");if(!le.password)return uni.$u.toast("请输入密码")}if(2==le.scene){if(!le.account)return uni.$u.toast("请输入手机号码");if(!le.code)return uni.$u.toast("请输入验证码")}S({title:"请稍后..."});try{const e=await R(le);me(e)}catch(e){j(),uni.$u.toast(e)}})),ye=async(e={getUrl:!0})=>{const{code:t,getUrl:a}=e;if(!a){return await G({code:t})}return await w.getUrl(V.LOGIN),Promise.reject()},he=async()=>{if(!ae.value&&de.value)return Y.value=!0,void console.log(Y.value);c.value&&ye()};C((()=>K.getLoginConfig),(e=>{e.login_way&&(le.scene=e.login_way[0])}),{immediate:!0});const _e=x((()=>!(1!=le.scene||!le.account||!le.password)||!(2!=le.scene||!le.account||!le.code)));return k((async()=>{const e=w.getAuthData();try{if(e.code&&e.scene===V.LOGIN){S({title:"请稍后..."});const t=await ye(e);t&&(se.value=t,me(se.value))}}catch(t){(()=>{const e=m.query;e.code&&e.state&&(delete e.code,delete e.state,H.redirectTo({path:m.path,query:e}))})()}finally{j(),w.setAuthData()}})),(n,m)=>{const g=e(t("page-meta"),D),y=e(t("u-image"),P),h=f,_=e(t("u-button"),W),b=e(t("u-input"),Z),v=F,x=e(t("u-verification-code"),E),C=q,k=e(t("u-checkbox"),M),w=e(t("u-modal"),X);return a(),d(p,null,[s(g,{"page-style":n.$theme.pageStyle},null,8,["page-style"]),s(h,{class:"bg-white login min-h-full flex flex-col items-center px-[40rpx] pt-[120rpx] box-border"},{default:o((()=>[s(h,null,{default:o((()=>[r(" 312 "),s(y,{src:$(K).getWebsiteConfig.shop_logo,mode:"widthFix",height:"160",width:"160"},null,8,["src"])])),_:1}),s(h,{class:"w-full mt-[140rpx] pb-[60rpx]"},{default:o((()=>[oe.value?i("v-if",!0):(a(),d(p,{key:0},[$(pe)&&c.value&&$(ce)?(a(),l(h,{key:0},{default:o((()=>[s(_,{type:"primary",onClick:he,customStyle:{height:"100rpx"},"hover-class":"none"},{default:o((()=>[r(" 用户一键登录 ")])),_:1})])),_:1})):i("v-if",!0),s(h,{class:"mt-[40rpx]"},{default:o((()=>[s(_,{onClick:m[0]||(m[0]=e=>oe.value=!oe.value),customStyle:{height:"100rpx"},"hover-class":"none"},{default:o((()=>[r(" 手机号登录 ")])),_:1})])),_:1})],64)),oe.value?(a(),d(p,{key:1},[i(" 密码登录 "),1==le.scene&&ie(1)?(a(),d(p,{key:0},[s(h,{class:"px-[18rpx] border border-solid border-lightc border-light rounded-[10rpx] h-[100rpx] items-center flex"},{default:o((()=>[s(b,{class:"flex-1",modelValue:le.account,"onUpdate:modelValue":m[1]||(m[1]=e=>le.account=e),border:!1,placeholder:"输入账号"},null,8,["modelValue"])])),_:1}),s(h,{class:"px-[18rpx] py-[10rpx] border border-solid border-light rounded-[10rpx] flex h-[100rpx] items-center mt-[40rpx]"},{default:o((()=>[s(b,{class:"flex-1",modelValue:le.password,"onUpdate:modelValue":m[2]||(m[2]=e=>le.password=e),type:"password",placeholder:"输入密码",border:!1},null,8,["modelValue"]),s(v,{url:"/pages/forget_pwd/forget_pwd","hover-class":"none"},{default:o((()=>[s(h,{class:"border-l border-solid border-0 border-light pl-3 text-muted leading-4 ml-3"},{default:o((()=>[r(" 忘记密码？ ")])),_:1})])),_:1})])),_:1})],64)):i("v-if",!0),i(" 验证码登录 "),2==le.scene&&ie(2)?(a(),d(p,{key:1},[s(h,{class:"px-[18rpx] border border-solid border-lightc border-light rounded-[10rpx] h-[100rpx] items-center flex"},{default:o((()=>[s(b,{class:"flex-1",modelValue:le.account,"onUpdate:modelValue":m[3]||(m[3]=e=>le.account=e),border:!1,placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1}),s(h,{class:"px-[18rpx] border border-solid border-lightc border-light rounded-[10rpx] h-[100rpx] items-center flex mt-[40rpx]"},{default:o((()=>[s(b,{class:"flex-1",modelValue:le.code,"onUpdate:modelValue":m[4]||(m[4]=e=>le.code=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),s(h,{class:"border-l border-solid border-0 border-light pl-3 leading-4 ml-3 w-[180rpx]",onClick:re},{default:o((()=>[s(x,{ref_key:"uCodeRef",ref:ee,seconds:60,onChange:ne,"change-text":"x秒"},null,512),s(C,{class:B(le.account?"text-primary":"text-muted")},{default:o((()=>[r(u(te.value),1)])),_:1},8,["class"])])),_:1})])),_:1})],64)):i("v-if",!0)],64)):i("v-if",!0),$(de)?(a(),l(h,{key:2,class:"mt-[40rpx]"},{default:o((()=>[s(k,{modelValue:ae.value,"onUpdate:modelValue":m[7]||(m[7]=e=>ae.value=e),shape:"circle"},{default:o((()=>[s(h,{class:"text-xs flex"},{default:o((()=>[r(" 已阅读并同意 "),s(h,{onClick:m[5]||(m[5]=T((()=>{}),["stop"]))},{default:o((()=>[s(v,{class:"text-primary","hover-class":"none",url:"/pages/agreement/agreement?type=service"},{default:o((()=>[r(" 《服务协议》 ")])),_:1})])),_:1}),r(" 和 "),s(h,{onClick:m[6]||(m[6]=T((()=>{}),["stop"]))},{default:o((()=>[s(v,{class:"text-primary","hover-class":"none",url:"/pages/agreement/agreement?type=privacy"},{default:o((()=>[r(" 《隐私协议》 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):i("v-if",!0),oe.value?(a(),d(p,{key:3},[s(h,{class:"mt-[60rpx]"},{default:o((()=>[s(_,{type:"primary",onClick:m[8]||(m[8]=e=>$(ge)(le.scene)),customStyle:{height:"100rpx",opacity:$(_e)?"1":"0.5"},"hover-class":"none"},{default:o((()=>[r(" 登录 ")])),_:1},8,["customStyle"])])),_:1}),s(h,{class:"flex justify-between mt-[40rpx]"},{default:o((()=>[s(h,null,{default:o((()=>[r("已有账号，使用 "),2==le.scene&&ie(1)?(a(),d("span",{key:0,class:"text-primary",onClick:m[9]||(m[9]=e=>ue(1))},"密码登录")):i("v-if",!0),1==le.scene&&ie(2)?(a(),d("span",{key:1,class:"text-primary",onClick:m[10]||(m[10]=e=>ue(2))},"验证码登录")):i("v-if",!0)])),_:1}),s(v,{url:"/pages/register/register","hover-class":"none"},{default:o((()=>[r("注册账号")])),_:1})])),_:1})],64)):i("v-if",!0)])),_:1}),i(" 协议弹框 "),s(w,{modelValue:Y.value,"onUpdate:modelValue":m[11]||(m[11]=e=>Y.value=e),"show-cancel-button":"","show-title":!1,onConfirm:m[12]||(m[12]=e=>{ae.value=!0,Y.value=!1}),onCancel:m[13]||(m[13]=e=>Y.value=!1)},{default:o((()=>[s(h,{class:"text-center px-[70rpx] py-[60rpx]"},{default:o((()=>[s(h,null,{default:o((()=>[r(" 请先阅读并同意 ")])),_:1}),s(h,{class:"flex justify-center"},{default:o((()=>[s(v,{"data-theme":"",url:"/pages/agreement/agreement?type=service"},{default:o((()=>[s(h,{class:"text-primary"},{default:o((()=>[r("《服务协议》")])),_:1})])),_:1}),r(" 和 "),s(v,{url:"/pages/agreement/agreement?type=privacy"},{default:o((()=>[s(h,{class:"text-primary"},{default:o((()=>[r("《隐私协议》")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})],64)}}}),[["__scopeId","data-v-1a3b5908"]]);export{Y as default};
