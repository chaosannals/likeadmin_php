import{r as e,a as t,o as a,b as l,w as o,e as s,n,l as r,t as u,f as i,E as c,g as d,F as p,p as f,d as m,z as g,aj as y,af as h,u as _,a0 as v,G as b,c as x,A as C,ah as k,a8 as w,ak as V,al as S,I as j,am as $,an as B,x as T,j as L,k as I,ao as U,v as z,ap as O,aq as N,M as A,ar as G,as as F,at as q,i as R,P as D,au as P}from"./index.c081890f.js";import{_ as W}from"./page-meta.12b6836c.js";import{_ as Z}from"./u-image.e7c183de.js";import{_ as E}from"./u-button.e487a8fc.js";import{_ as M}from"./u-input.7f44251a.js";import{_ as H}from"./u-verification-code.140c7f86.js";import{_ as J}from"./u-checkbox.eab9d14a.js";import{_ as K}from"./u-loading.0ba8a7e4.js";import{_ as Q}from"./u-popup.75f0193e.js";import{_ as X}from"./plugin-vue_export-helper.21dcd24c.js";import{u as Y}from"./useLockFn.87e4c078.js";import"./u-icon.bec2a19e.js";import"./emitter.5b880544.js";var ee=X({name:"u-modal",emits:["update:modelValue","input","confirm","cancel"],props:{value:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!1},zIndex:{type:[Number,String],default:""},title:{type:[String],default:"提示"},width:{type:[Number,String],default:600},content:{type:String,default:"内容"},showTitle:{type:Boolean,default:!0},showConfirmButton:{type:Boolean,default:!0},showCancelButton:{type:Boolean,default:!1},confirmText:{type:String,default:"确认"},cancelText:{type:String,default:"取消"},confirmColor:{type:String,default:"#2979ff"},cancelColor:{type:String,default:"#606266"},borderRadius:{type:[Number,String],default:16},titleStyle:{type:Object,default:()=>({})},contentStyle:{type:Object,default:()=>({})},cancelStyle:{type:Object,default:()=>({})},confirmStyle:{type:Object,default:()=>({})},zoom:{type:Boolean,default:!0},asyncClose:{type:Boolean,default:!1},maskCloseAble:{type:Boolean,default:!1},negativeTop:{type:[String,Number],default:0},blur:{type:[Number,String],default:0}},data:()=>({loading:!1,popupValue:!1}),computed:{valueCom(){return this.modelValue},cancelBtnStyle(){return Object.assign({color:this.cancelColor},this.cancelStyle)},confirmBtnStyle(){return Object.assign({color:this.confirmColor},this.confirmStyle)},uZIndex(){return this.zIndex?this.zIndex:this.$u.zIndex.popup}},watch:{valueCom(e){!0===e&&(this.loading=!1),this.popupValue=e}},methods:{confirm(){this.asyncClose?this.loading=!0:(this.$emit("input",!1),this.$emit("update:modelValue",!1)),this.$emit("confirm")},cancel(){this.$emit("cancel"),this.$emit("input",!1),this.$emit("update:modelValue",!1),setTimeout((()=>{this.loading=!1}),300)},popupClose(){this.$emit("input",!1),this.$emit("update:modelValue",!1)},clearLoading(){this.loading=!1}}},[["render",function(m,g,y,h,_,v){const b=f,x=e(t("u-loading"),K),C=e(t("u-popup"),Q);return a(),l(b,null,{default:o((()=>[s(C,{blur:y.blur,zoom:y.zoom,mode:"center",popup:!1,"z-index":v.uZIndex,modelValue:_.popupValue,"onUpdate:modelValue":g[0]||(g[0]=e=>_.popupValue=e),length:y.width,"mask-close-able":y.maskCloseAble,"border-radius":y.borderRadius,onClose:v.popupClose,"negative-top":y.negativeTop},{default:o((()=>[s(b,{class:"u-model"},{default:o((()=>[y.showTitle?(a(),l(b,{key:0,class:"u-model__title u-line-1",style:n([y.titleStyle])},{default:o((()=>[r(u(y.title),1)])),_:1},8,["style"])):i("v-if",!0),s(b,{class:"u-model__content"},{default:o((()=>[m.$slots.default||m.$slots.$default?(a(),l(b,{key:0,style:n([y.contentStyle])},{default:o((()=>[c(m.$slots,"default",{},void 0,!0)])),_:3},8,["style"])):(a(),l(b,{key:1,class:"u-model__content__message",style:n([y.contentStyle])},{default:o((()=>[r(u(y.content),1)])),_:1},8,["style"]))])),_:3}),y.showCancelButton||y.showConfirmButton?(a(),l(b,{key:1,class:"u-model__footer u-border-top"},{default:o((()=>[y.showCancelButton?(a(),l(b,{key:0,"hover-stay-time":100,"hover-class":"u-model__btn--hover",class:"u-model__footer__button",style:n([v.cancelBtnStyle]),onClick:v.cancel},{default:o((()=>[r(u(y.cancelText),1)])),_:1},8,["style","onClick"])):i("v-if",!0),y.showConfirmButton||m.$slots["confirm-button"]?(a(),l(b,{key:1,"hover-stay-time":100,"hover-class":y.asyncClose?"none":"u-model__btn--hover",class:"u-model__footer__button hairline-left",style:n([v.confirmBtnStyle]),onClick:v.confirm},{default:o((()=>[m.$slots["confirm-button"]?c(m.$slots,"confirm-button",{key:0},void 0,!0):(a(),d(p,{key:1},[_.loading?(a(),l(x,{key:0,mode:"circle",color:y.confirmColor},null,8,["color"])):(a(),d(p,{key:1},[r(u(y.confirmText),1)],64))],64))])),_:3},8,["hover-class","style","onClick"])):i("v-if",!0)])),_:3})):i("v-if",!0)])),_:3})])),_:3},8,["blur","zoom","z-index","modelValue","length","mask-close-able","border-radius","onClose","negative-top"])])),_:3})}],["__scopeId","data-v-35116f03"]]);var te=X(m({__name:"login",setup(n){const c=g(!0);c.value=y();const m=U(),K=z(),Q=h(),X=_(),te=g(!1),ae=v(),le=g("");g(!1);const oe=g(!1),se=b({scene:1,account:"",password:"",code:""}),ne=g(!1),re=g(),ue=e=>{le.value=e};x((()=>X.getWebsiteConfig));const ie=async()=>{var e,t;se.account&&(null==(e=ae.value)?void 0:e.canGetCode)&&(await O({scene:N.LOGIN,mobile:se.account}),uni.$u.toast("发送成功"),null==(t=ae.value)||t.start())},ce=e=>{se.scene=e},de=e=>{var t;return null==(t=X.getLoginConfig.login_way)?void 0:t.includes(String(e))},pe=x((()=>X.getLoginConfig.wechat_auth)),fe=x((()=>1==X.getLoginConfig.login_agreement)),me=x((()=>1==X.getLoginConfig.third_auth)),ge=x((()=>1==X.getLoginConfig.coerce_mobile)),ye=async e=>{const{token:t,mobile:a}=e;if(!a&&ge.value)return Q.temToken=t,K.navigateTo("/pages/bind_mobile/bind_mobile"),void V();Q.login(e.token),await Q.getUser(),uni.$u.toast("登录成功"),V();if(A().length>1)await K.navigateBack();else if(G.get(F))try{K.redirectTo(G.get(F))}finally{K.switchTab(G.get(F))}else K.reLaunch("/pages/index/index");G.remove(F)},{lockFn:he}=Y((async()=>{if(!oe.value&&fe.value)return te.value=!0;if(1==se.scene){if(!se.account)return uni.$u.toast("请输入账号/手机号码");if(!se.password)return uni.$u.toast("请输入密码")}if(2==se.scene){if(!se.account)return uni.$u.toast("请输入手机号码");if(!se.code)return uni.$u.toast("请输入验证码")}w({title:"请稍后..."});try{const e=await P(se);ye(e)}catch(e){V(),uni.$u.toast(e)}})),_e=async(e={getUrl:!0})=>{const{code:t,getUrl:a}=e;if(!a){return await q({code:t})}return await $.getUrl(B.LOGIN),Promise.reject()},ve=async()=>{if(!oe.value&&fe.value)return te.value=!0,void console.log(te.value);c.value&&_e()};C((()=>X.getLoginConfig),(e=>{e.login_way&&(se.scene=e.login_way[0])}),{immediate:!0});const be=x((()=>!(1!=se.scene||!se.account||!se.password)||!(2!=se.scene||!se.account||!se.code)));k((async()=>{try{Q.isLogin&&(w({title:"请稍后..."}),await Q.getUser(),V(),S())}catch(e){V()}}));return j((async()=>{const e=$.getAuthData();try{if(e.code&&e.scene===B.LOGIN){w({title:"请稍后..."});const t=await _e(e);t&&(re.value=t,ye(re.value))}}catch(t){(()=>{const e=m.query;e.code&&e.state&&(delete e.code,delete e.state,K.redirectTo({path:m.path,query:e}))})()}finally{V(),$.setAuthData()}})),(n,m)=>{const g=e(t("page-meta"),W),y=e(t("u-image"),Z),h=f,_=e(t("u-button"),E),v=e(t("u-input"),M),b=R,x=e(t("u-verification-code"),H),C=D,k=e(t("u-checkbox"),J),w=e(t("u-modal"),ee);return a(),d(p,null,[s(g,{"page-style":n.$theme.pageStyle},null,8,["page-style"]),s(h,{class:"bg-white login min-h-full flex flex-col items-center px-[40rpx] pt-[120rpx] box-border"},{default:o((()=>[s(h,null,{default:o((()=>[s(y,{src:T(X).getWebsiteConfig.shop_logo,mode:"widthFix",height:"160",width:"160"},null,8,["src"])])),_:1}),s(h,{class:"w-full mt-[140rpx] pb-[60rpx]"},{default:o((()=>[ne.value?i("v-if",!0):(a(),d(p,{key:0},[T(me)&&c.value&&T(pe)?(a(),l(h,{key:0},{default:o((()=>[s(_,{type:"primary",onClick:ve,customStyle:{height:"100rpx"},"hover-class":"none"},{default:o((()=>[r(" 用户一键登录 ")])),_:1})])),_:1})):i("v-if",!0),s(h,{class:"mt-[40rpx]"},{default:o((()=>[s(_,{onClick:m[0]||(m[0]=e=>ne.value=!ne.value),customStyle:{height:"100rpx"},"hover-class":"none"},{default:o((()=>[r(" 手机号登录 ")])),_:1})])),_:1})],64)),ne.value?(a(),d(p,{key:1},[i(" 密码登录 "),1==se.scene&&de(1)?(a(),d(p,{key:0},[s(h,{class:"px-[18rpx] border border-solid border-lightc border-light rounded-[10rpx] h-[100rpx] items-center flex"},{default:o((()=>[s(v,{class:"flex-1",modelValue:se.account,"onUpdate:modelValue":m[1]||(m[1]=e=>se.account=e),border:!1,placeholder:"输入账号"},null,8,["modelValue"])])),_:1}),s(h,{class:"px-[18rpx] py-[10rpx] border border-solid border-light rounded-[10rpx] flex h-[100rpx] items-center mt-[40rpx]"},{default:o((()=>[s(v,{class:"flex-1",modelValue:se.password,"onUpdate:modelValue":m[2]||(m[2]=e=>se.password=e),type:"password",placeholder:"输入密码",border:!1},null,8,["modelValue"]),s(b,{url:"/pages/forget_pwd/forget_pwd","hover-class":"none"},{default:o((()=>[s(h,{class:"border-l border-solid border-0 border-light pl-3 text-muted leading-4 ml-3"},{default:o((()=>[r(" 忘记密码？ ")])),_:1})])),_:1})])),_:1})],64)):i("v-if",!0),i(" 验证码登录 "),2==se.scene&&de(2)?(a(),d(p,{key:1},[s(h,{class:"px-[18rpx] border border-solid border-lightc border-light rounded-[10rpx] h-[100rpx] items-center flex"},{default:o((()=>[s(v,{class:"flex-1",modelValue:se.account,"onUpdate:modelValue":m[3]||(m[3]=e=>se.account=e),border:!1,placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1}),s(h,{class:"px-[18rpx] border border-solid border-lightc border-light rounded-[10rpx] h-[100rpx] items-center flex mt-[40rpx]"},{default:o((()=>[s(v,{class:"flex-1",modelValue:se.code,"onUpdate:modelValue":m[4]||(m[4]=e=>se.code=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),s(h,{class:"border-l border-solid border-0 border-light pl-3 leading-4 ml-3 w-[180rpx]",onClick:ie},{default:o((()=>[s(x,{ref_key:"uCodeRef",ref:ae,seconds:60,onChange:ue,"change-text":"x秒"},null,512),s(C,{class:L(se.account?"text-primary":"text-muted")},{default:o((()=>[r(u(le.value),1)])),_:1},8,["class"])])),_:1})])),_:1})],64)):i("v-if",!0)],64)):i("v-if",!0),T(fe)?(a(),l(h,{key:2,class:"mt-[40rpx]"},{default:o((()=>[s(k,{modelValue:oe.value,"onUpdate:modelValue":m[7]||(m[7]=e=>oe.value=e),shape:"circle"},{default:o((()=>[s(h,{class:"text-xs flex"},{default:o((()=>[r(" 已阅读并同意 "),s(h,{onClick:m[5]||(m[5]=I((()=>{}),["stop"]))},{default:o((()=>[s(b,{class:"text-primary","hover-class":"none",url:"/pages/agreement/agreement?type=service"},{default:o((()=>[r(" 《服务协议》 ")])),_:1})])),_:1}),r(" 和 "),s(h,{onClick:m[6]||(m[6]=I((()=>{}),["stop"]))},{default:o((()=>[s(b,{class:"text-primary","hover-class":"none",url:"/pages/agreement/agreement?type=privacy"},{default:o((()=>[r(" 《隐私协议》 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):i("v-if",!0),ne.value?(a(),d(p,{key:3},[s(h,{class:"mt-[60rpx]"},{default:o((()=>[s(_,{type:"primary",onClick:m[8]||(m[8]=e=>T(he)(se.scene)),customStyle:{height:"100rpx",opacity:T(be)?"1":"0.5"},"hover-class":"none"},{default:o((()=>[r(" 登录 ")])),_:1},8,["customStyle"])])),_:1}),s(h,{class:"flex justify-between mt-[40rpx]"},{default:o((()=>[s(h,null,{default:o((()=>[r("已有账号，使用 "),2==se.scene&&de(1)?(a(),d("span",{key:0,class:"text-primary",onClick:m[9]||(m[9]=e=>ce(1))},"密码登录")):i("v-if",!0),1==se.scene&&de(2)?(a(),d("span",{key:1,class:"text-primary",onClick:m[10]||(m[10]=e=>ce(2))},"验证码登录")):i("v-if",!0)])),_:1}),s(b,{url:"/pages/register/register","hover-class":"none"},{default:o((()=>[r("注册账号")])),_:1})])),_:1})],64)):i("v-if",!0)])),_:1}),i(" 协议弹框 "),s(w,{modelValue:te.value,"onUpdate:modelValue":m[11]||(m[11]=e=>te.value=e),"show-cancel-button":"","show-title":!1,onConfirm:m[12]||(m[12]=e=>{oe.value=!0,te.value=!1}),onCancel:m[13]||(m[13]=e=>te.value=!1)},{default:o((()=>[s(h,{class:"text-center px-[70rpx] py-[60rpx]"},{default:o((()=>[s(h,null,{default:o((()=>[r(" 请先阅读并同意 ")])),_:1}),s(h,{class:"flex justify-center"},{default:o((()=>[s(b,{"data-theme":"",url:"/pages/agreement/agreement?type=service"},{default:o((()=>[s(h,{class:"text-primary"},{default:o((()=>[r("《服务协议》")])),_:1})])),_:1}),r(" 和 "),s(b,{url:"/pages/agreement/agreement?type=privacy"},{default:o((()=>[s(h,{class:"text-primary"},{default:o((()=>[r("《隐私协议》")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})],64)}}}),[["__scopeId","data-v-bea0e28e"]]);export{te as default};
