import{r as e,a as t,o as l,b as a,w as o,e as s,n,l as r,t as u,f as i,E as c,g as d,F as p,p as f,d as m,z as g,ak as y,ag as h,u as _,a1 as b,G as v,c as x,A as C,I as k,al as w,am as V,a9 as S,an as $,x as j,j as B,k as T,ao as L,v as I,ap as z,aq as U,N,ar as O,as as A,at as G,i as F,Q as q,au as R}from"./index.13981c47.js";import{_ as D}from"./page-meta.3261f061.js";import{_ as W}from"./u-image.ec39ed81.js";import{_ as Z}from"./u-button.96c63949.js";import{_ as E}from"./u-input.b9e898a6.js";import{_ as P}from"./u-verification-code.48e60d60.js";import{_ as Q}from"./u-checkbox.f6f3d1b4.js";import{_ as H}from"./u-loading.1d4fdffa.js";import{_ as J}from"./u-popup.d9727535.js";import{_ as K}from"./plugin-vue_export-helper.21dcd24c.js";import{u as M}from"./useLockFn.fc09f26b.js";import"./u-icon.26a4bf62.js";import"./emitter.5b880544.js";var X=K({name:"u-modal",emits:["update:modelValue","input","confirm","cancel"],props:{value:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!1},zIndex:{type:[Number,String],default:""},title:{type:[String],default:"提示"},width:{type:[Number,String],default:600},content:{type:String,default:"内容"},showTitle:{type:Boolean,default:!0},showConfirmButton:{type:Boolean,default:!0},showCancelButton:{type:Boolean,default:!1},confirmText:{type:String,default:"确认"},cancelText:{type:String,default:"取消"},confirmColor:{type:String,default:"#2979ff"},cancelColor:{type:String,default:"#606266"},borderRadius:{type:[Number,String],default:16},titleStyle:{type:Object,default:()=>({})},contentStyle:{type:Object,default:()=>({})},cancelStyle:{type:Object,default:()=>({})},confirmStyle:{type:Object,default:()=>({})},zoom:{type:Boolean,default:!0},asyncClose:{type:Boolean,default:!1},maskCloseAble:{type:Boolean,default:!1},negativeTop:{type:[String,Number],default:0},blur:{type:[Number,String],default:0}},data:()=>({loading:!1,popupValue:!1}),computed:{valueCom(){return this.modelValue},cancelBtnStyle(){return Object.assign({color:this.cancelColor},this.cancelStyle)},confirmBtnStyle(){return Object.assign({color:this.confirmColor},this.confirmStyle)},uZIndex(){return this.zIndex?this.zIndex:this.$u.zIndex.popup}},watch:{valueCom(e){!0===e&&(this.loading=!1),this.popupValue=e}},methods:{confirm(){this.asyncClose?this.loading=!0:(this.$emit("input",!1),this.$emit("update:modelValue",!1)),this.$emit("confirm")},cancel(){this.$emit("cancel"),this.$emit("input",!1),this.$emit("update:modelValue",!1),setTimeout((()=>{this.loading=!1}),300)},popupClose(){this.$emit("input",!1),this.$emit("update:modelValue",!1)},clearLoading(){this.loading=!1}}},[["render",function(m,g,y,h,_,b){const v=f,x=e(t("u-loading"),H),C=e(t("u-popup"),J);return l(),a(v,null,{default:o((()=>[s(C,{blur:y.blur,zoom:y.zoom,mode:"center",popup:!1,"z-index":b.uZIndex,modelValue:_.popupValue,"onUpdate:modelValue":g[0]||(g[0]=e=>_.popupValue=e),length:y.width,"mask-close-able":y.maskCloseAble,"border-radius":y.borderRadius,onClose:b.popupClose,"negative-top":y.negativeTop},{default:o((()=>[s(v,{class:"u-model"},{default:o((()=>[y.showTitle?(l(),a(v,{key:0,class:"u-model__title u-line-1",style:n([y.titleStyle])},{default:o((()=>[r(u(y.title),1)])),_:1},8,["style"])):i("v-if",!0),s(v,{class:"u-model__content"},{default:o((()=>[m.$slots.default||m.$slots.$default?(l(),a(v,{key:0,style:n([y.contentStyle])},{default:o((()=>[c(m.$slots,"default",{},void 0,!0)])),_:3},8,["style"])):(l(),a(v,{key:1,class:"u-model__content__message",style:n([y.contentStyle])},{default:o((()=>[r(u(y.content),1)])),_:1},8,["style"]))])),_:3}),y.showCancelButton||y.showConfirmButton?(l(),a(v,{key:1,class:"u-model__footer u-border-top"},{default:o((()=>[y.showCancelButton?(l(),a(v,{key:0,"hover-stay-time":100,"hover-class":"u-model__btn--hover",class:"u-model__footer__button",style:n([b.cancelBtnStyle]),onClick:b.cancel},{default:o((()=>[r(u(y.cancelText),1)])),_:1},8,["style","onClick"])):i("v-if",!0),y.showConfirmButton||m.$slots["confirm-button"]?(l(),a(v,{key:1,"hover-stay-time":100,"hover-class":y.asyncClose?"none":"u-model__btn--hover",class:"u-model__footer__button hairline-left",style:n([b.confirmBtnStyle]),onClick:b.confirm},{default:o((()=>[m.$slots["confirm-button"]?c(m.$slots,"confirm-button",{key:0},void 0,!0):(l(),d(p,{key:1},[_.loading?(l(),a(x,{key:0,mode:"circle",color:y.confirmColor},null,8,["color"])):(l(),d(p,{key:1},[r(u(y.confirmText),1)],64))],64))])),_:3},8,["hover-class","style","onClick"])):i("v-if",!0)])),_:3})):i("v-if",!0)])),_:3})])),_:3},8,["blur","zoom","z-index","modelValue","length","mask-close-able","border-radius","onClose","negative-top"])])),_:3})}],["__scopeId","data-v-35116f03"]]);var Y=K(m({__name:"login",setup(n){const c=g(!0);c.value=y();const m=L(),H=I(),J=h(),K=_(),Y=g(!1),ee=b(),te=g("");g(!1);const le=g(!1),ae=v({scene:1,account:"",password:"",code:""}),oe=g(!1),se=g(),ne=e=>{te.value=e};x((()=>K.getWebsiteConfig));const re=async()=>{var e,t;ae.account&&(null==(e=ee.value)?void 0:e.canGetCode)&&(await z({scene:U.LOGIN,mobile:ae.account}),uni.$u.toast("发送成功"),null==(t=ee.value)||t.start())},ue=e=>{ae.scene=e},ie=e=>{var t;return null==(t=K.getLoginConfig.login_way)?void 0:t.includes(String(e))},ce=x((()=>K.getLoginConfig.wechat_auth)),de=x((()=>1==K.getLoginConfig.login_agreement)),pe=x((()=>1==K.getLoginConfig.third_auth)),fe=x((()=>1==K.getLoginConfig.coerce_mobile)),me=async e=>{const{token:t,mobile:l}=e;if(!l&&fe.value)return J.temToken=t,H.navigateTo("/pages/bind_mobile/bind_mobile"),void $();J.login(e.token),await J.getUser(),uni.$u.toast("登录成功"),$();const a=N();if(a.length>1){const e=a[a.length-2];await H.navigateBack();const{onLoad:t,options:l}=e;t&&t(l)}else if(O.get(A))try{H.redirectTo(O.get(A))}finally{H.switchTab(O.get(A))}else H.reLaunch("/pages/index/index");O.remove(A)},{lockFn:ge}=M((async()=>{if(!le.value&&de.value)return Y.value=!0;if(1==ae.scene){if(!ae.account)return uni.$u.toast("请输入账号/手机号码");if(!ae.password)return uni.$u.toast("请输入密码")}if(2==ae.scene){if(!ae.account)return uni.$u.toast("请输入手机号码");if(!ae.code)return uni.$u.toast("请输入验证码")}S({title:"请稍后..."});try{const e=await R(ae);me(e)}catch(e){$(),uni.$u.toast(e)}})),ye=async(e={getUrl:!0})=>{const{code:t,getUrl:l}=e;if(!l){return await G({code:t})}return await w.getUrl(V.LOGIN),Promise.reject()},he=async()=>{if(!le.value&&de.value)return Y.value=!0,void console.log(Y.value);c.value&&ye()};C((()=>K.getLoginConfig),(e=>{e.login_way&&(ae.scene=e.login_way[0])}),{immediate:!0});const _e=x((()=>!(1!=ae.scene||!ae.account||!ae.password)||!(2!=ae.scene||!ae.account||!ae.code)));return k((async()=>{const e=w.getAuthData();try{if(e.code&&e.scene===V.LOGIN){S({title:"请稍后..."});const t=await ye(e);t&&(se.value=t,me(se.value))}}catch(t){(()=>{const e=m.query;e.code&&e.state&&(delete e.code,delete e.state,H.redirectTo({path:m.path,query:e}))})()}finally{$(),w.setAuthData()}})),(n,m)=>{const g=e(t("page-meta"),D),y=e(t("u-image"),W),h=f,_=e(t("u-button"),Z),b=e(t("u-input"),E),v=F,x=e(t("u-verification-code"),P),C=q,k=e(t("u-checkbox"),Q),w=e(t("u-modal"),X);return l(),d(p,null,[s(g,{"page-style":n.$theme.pageStyle},null,8,["page-style"]),s(h,{class:"bg-white login min-h-full flex flex-col items-center px-[40rpx] pt-[120rpx] box-border"},{default:o((()=>[s(h,null,{default:o((()=>[s(y,{src:j(K).getWebsiteConfig.shop_logo,mode:"widthFix",height:"160",width:"160"},null,8,["src"])])),_:1}),s(h,{class:"w-full mt-[140rpx] pb-[60rpx]"},{default:o((()=>[oe.value?i("v-if",!0):(l(),d(p,{key:0},[j(pe)&&c.value&&j(ce)?(l(),a(h,{key:0},{default:o((()=>[s(_,{type:"primary",onClick:he,customStyle:{height:"100rpx"},"hover-class":"none"},{default:o((()=>[r(" 用户一键登录 ")])),_:1})])),_:1})):i("v-if",!0),s(h,{class:"mt-[40rpx]"},{default:o((()=>[s(_,{onClick:m[0]||(m[0]=e=>oe.value=!oe.value),customStyle:{height:"100rpx"},"hover-class":"none"},{default:o((()=>[r(" 手机号登录 ")])),_:1})])),_:1})],64)),oe.value?(l(),d(p,{key:1},[i(" 密码登录 "),1==ae.scene&&ie(1)?(l(),d(p,{key:0},[s(h,{class:"px-[18rpx] border border-solid border-lightc border-light rounded-[10rpx] h-[100rpx] items-center flex"},{default:o((()=>[s(b,{class:"flex-1",modelValue:ae.account,"onUpdate:modelValue":m[1]||(m[1]=e=>ae.account=e),border:!1,placeholder:"输入账号"},null,8,["modelValue"])])),_:1}),s(h,{class:"px-[18rpx] py-[10rpx] border border-solid border-light rounded-[10rpx] flex h-[100rpx] items-center mt-[40rpx]"},{default:o((()=>[s(b,{class:"flex-1",modelValue:ae.password,"onUpdate:modelValue":m[2]||(m[2]=e=>ae.password=e),type:"password",placeholder:"输入密码",border:!1},null,8,["modelValue"]),s(v,{url:"/pages/forget_pwd/forget_pwd","hover-class":"none"},{default:o((()=>[s(h,{class:"border-l border-solid border-0 border-light pl-3 text-muted leading-4 ml-3"},{default:o((()=>[r(" 忘记密码？ ")])),_:1})])),_:1})])),_:1})],64)):i("v-if",!0),i(" 验证码登录 "),2==ae.scene&&ie(2)?(l(),d(p,{key:1},[s(h,{class:"px-[18rpx] border border-solid border-lightc border-light rounded-[10rpx] h-[100rpx] items-center flex"},{default:o((()=>[s(b,{class:"flex-1",modelValue:ae.account,"onUpdate:modelValue":m[3]||(m[3]=e=>ae.account=e),border:!1,placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1}),s(h,{class:"px-[18rpx] border border-solid border-lightc border-light rounded-[10rpx] h-[100rpx] items-center flex mt-[40rpx]"},{default:o((()=>[s(b,{class:"flex-1",modelValue:ae.code,"onUpdate:modelValue":m[4]||(m[4]=e=>ae.code=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),s(h,{class:"border-l border-solid border-0 border-light pl-3 leading-4 ml-3 w-[180rpx]",onClick:re},{default:o((()=>[s(x,{ref_key:"uCodeRef",ref:ee,seconds:60,onChange:ne,"change-text":"x秒"},null,512),s(C,{class:B(ae.account?"text-primary":"text-muted")},{default:o((()=>[r(u(te.value),1)])),_:1},8,["class"])])),_:1})])),_:1})],64)):i("v-if",!0)],64)):i("v-if",!0),j(de)?(l(),a(h,{key:2,class:"mt-[40rpx]"},{default:o((()=>[s(k,{modelValue:le.value,"onUpdate:modelValue":m[7]||(m[7]=e=>le.value=e),shape:"circle"},{default:o((()=>[s(h,{class:"text-xs flex"},{default:o((()=>[r(" 已阅读并同意 "),s(h,{onClick:m[5]||(m[5]=T((()=>{}),["stop"]))},{default:o((()=>[s(v,{class:"text-primary","hover-class":"none",url:"/pages/agreement/agreement?type=service"},{default:o((()=>[r(" 《服务协议》 ")])),_:1})])),_:1}),r(" 和 "),s(h,{onClick:m[6]||(m[6]=T((()=>{}),["stop"]))},{default:o((()=>[s(v,{class:"text-primary","hover-class":"none",url:"/pages/agreement/agreement?type=privacy"},{default:o((()=>[r(" 《隐私协议》 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})):i("v-if",!0),oe.value?(l(),d(p,{key:3},[s(h,{class:"mt-[60rpx]"},{default:o((()=>[s(_,{type:"primary",onClick:m[8]||(m[8]=e=>j(ge)(ae.scene)),customStyle:{height:"100rpx",opacity:j(_e)?"1":"0.5"},"hover-class":"none"},{default:o((()=>[r(" 登录 ")])),_:1},8,["customStyle"])])),_:1}),s(h,{class:"flex justify-between mt-[40rpx]"},{default:o((()=>[s(h,null,{default:o((()=>[r("已有账号，使用 "),2==ae.scene&&ie(1)?(l(),d("span",{key:0,class:"text-primary",onClick:m[9]||(m[9]=e=>ue(1))},"密码登录")):i("v-if",!0),1==ae.scene&&ie(2)?(l(),d("span",{key:1,class:"text-primary",onClick:m[10]||(m[10]=e=>ue(2))},"验证码登录")):i("v-if",!0)])),_:1}),s(v,{url:"/pages/register/register","hover-class":"none"},{default:o((()=>[r("注册账号")])),_:1})])),_:1})],64)):i("v-if",!0)])),_:1}),i(" 协议弹框 "),s(w,{modelValue:Y.value,"onUpdate:modelValue":m[11]||(m[11]=e=>Y.value=e),"show-cancel-button":"","show-title":!1,onConfirm:m[12]||(m[12]=e=>{le.value=!0,Y.value=!1}),onCancel:m[13]||(m[13]=e=>Y.value=!1)},{default:o((()=>[s(h,{class:"text-center px-[70rpx] py-[60rpx]"},{default:o((()=>[s(h,null,{default:o((()=>[r(" 请先阅读并同意 ")])),_:1}),s(h,{class:"flex justify-center"},{default:o((()=>[s(v,{"data-theme":"",url:"/pages/agreement/agreement?type=service"},{default:o((()=>[s(h,{class:"text-primary"},{default:o((()=>[r("《服务协议》")])),_:1})])),_:1}),r(" 和 "),s(v,{url:"/pages/agreement/agreement?type=privacy"},{default:o((()=>[s(h,{class:"text-primary"},{default:o((()=>[r("《隐私协议》")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})],64)}}}),[["__scopeId","data-v-13b599be"]]);export{Y as default};
